<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pocket Phrasebook (EN · ES · PT · FR · IT · RU· DE)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f1a2b; --muted:#90a4b0; --text:#eaf2ff; --accent:#48d597; --accent2:#7aa0ff; --danger:#ff6b6b;
    --ring: rgba(122,160,255,.35); --shadow: 0 12px 30px rgba(0,0,0,.35); --chip:#18253a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:linear-gradient(180deg,#0a1120,#0c1426 40%,#0b1220);
    color:var(--text);
    font:500 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  h1{font-weight:800;letter-spacing:.3px;margin:0 0 8px;font-size:28px}
  .sub{color:var(--muted);margin:0 0 18px}
  .panel{background:var(--panel);border:1px solid #1a2944;border-radius:18px;box-shadow:var(--shadow)}
  .controls{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;padding:16px;border-bottom:1px solid #1a2944}
  @media (max-width:900px){.controls{grid-template-columns:1fr 1fr}.show-all{grid-column:1/-1}}
  @media (max-width:640px){.controls{grid-template-columns:1fr}.show-all{grid-column:auto}}
  label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
  select,input[type="text"]{
    width:100%;
    padding:12px 12px;
    border-radius:12px;
    background:#0b162a;
    font-size: 16px;
    color:var(--text);
    border:1px solid #1a2944;
    outline:none;
    transition:.2s box-shadow;
  }
  select:focus,input[type="text"]:focus{box-shadow:0 0 0 3px var(--ring)}
  .chips{display:flex;flex-wrap:wrap;gap:8px;padding:12px 16px;border-bottom:1px solid #1a2944}
  .chip{
    background:var(--chip);
    border:1px solid #243a64;
    color:#cfe0ff;
    padding:8px 12px;
    border-radius:999px;
    font-size:12px;
    cursor:pointer;
    user-select:none;
  }
  .chip.active{
    background:#173255;
    border-color:#2f6fd3;
    color:#e9f1ff;
    box-shadow:0 0 0 2px rgba(79,139,255,.25) inset;
  }
  .toolbar{display:flex;gap:10px;align-items:center;padding:12px 16px;border-bottom:1px solid #1a2944}
  .toolbar .switch{display:flex;align-items:center;gap:10px;margin-left:auto}
  .switch input{
    appearance:none;
    width:46px;
    height:28px;
    background:#21324f;
    border-radius:999px;
    position:relative;
    outline:none;
    cursor:pointer;
    transition:.2s;
  }
  .switch input:checked{background:#265f3f}
  .switch input:before{
    content:\"\";position:absolute;top:4px;left:4px;
    width:20px;height:20px;border-radius:50%;
    background:#eaf2ff;transition:.2s;
  }
  .switch input:checked:before{left:22px}
  .results{padding:8px}
  table{width:100%;border-collapse:separate;border-spacing:0 10px}
  th,td{padding:12px 14px;text-align:left}
  th{font-size:12px;color:#9fb3c5;text-transform:uppercase;letter-spacing:.6px}
  tr{background:#0c1730;border:1px solid #1a2944}
  tr td:first-child{border-radius:12px 0 0 12px}
  tr td:last-child{border-radius:0 12px 12px 0}
  .langTag{font-size:12px;color:#9fb3c5}
  .big{font-size:16px}
  .rowtools{display:flex;gap:8px}
  button.icon{
    display:inline-flex;
    align-items:center;
    gap:6px;
    border:1px solid #26406b;
    background:#15233a;
    color:#eaf2ff;
    padding:8px 10px;
    border-radius:10px;
    cursor:pointer;
  }
  button.icon:hover{background:#1a2c4a}
  .footer{color:#8ea3b6;font-size:12px;margin:14px 2px}
  .stat{padding:8px 12px;border:1px dashed #203357;border-radius:10px}
  .empty{color:#9fb3c5;padding:24px;text-align:center}
</style>

</head>
<body>
  <div class="wrap">
    <h1>🧭 Pocket Phrasebook (from Prepper Disk)</h1>
    <p class="sub">Search by <strong>category</strong> or <strong>phrase</strong>. Choose a <strong>From</strong> and <strong>To</strong> language. 
      <span class="stat" id="stat"></span>
    </p>

    <div class="panel">
      <div class="controls">
        <div>
          <label for="fromLang">From</label>
          <select id="fromLang"></select>
        </div>
        <div>
          <label for="toLang">To</label>
          <select id="toLang"></select>
        </div>
        <div>
          <label for="q">Search (phrase or keyword)</label>
          <input id="q" type="text" placeholder="e.g., water, hospital, hello" />
        </div>
      </div>

      <div class="chips" id="chips"></div>

      <div class="toolbar">
        <div class="rowtools">
          <button class="icon" id="clearFilters">Clear filters</button>
          <button class="icon" id="randomBtn">Random phrase</button>
        </div>
        <div class="switch show-all">
          <label>Show all target languages</label>
          <input id="showAll" type="checkbox"/>
        </div>
      </div>

      <div class="results">
        <table>
          <thead>
            <tr>
              <th style="width:140px">Category</th>
              <th>From <span class="langTag" id="fromTag"></span></th>
              <th>To <span class="langTag" id="toTag"></span></th>
              <th style="width:210px">Tools</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div id="empty" class="empty" style="display:none">No results. Try a different search or category.</div>
      </div>
    </div>

    <p class="footer">Tip: Click the speaker to play with your device's built‑in offline speech (if available). Copy sends the translated text to your clipboard for quick sharing.</p>
  </div>

<script>
  const LANGS = [
    { code:'en', name:'English 🇺🇸 🇬🇧 🇦🇺', tts: 'en-US' },
    { code:'es', name:'Español 🇪🇸 🇲🇽', tts: 'es-ES' },
    { code:'pt', name:'Português 🇵🇹 🇧🇷', tts: 'pt-PT' },
    { code:'fr', name:'Français 🇫🇷', tts: 'fr-FR' },
    { code:'it', name:'Italiano 🇮🇹', tts: 'it-IT' },
    { code:'ru', name:'Русский 🇷🇺', tts: 'ru-RU' },
    { code:'de', name:'Deutsch 🇩🇪', tts: 'de-DE' }
  ];

  const CATS = [
    'Basics','Social','Numbers & Time','Directions','Transport','Food & Water','Lodging','Shopping & Trade','Health','Emergency',
    'Safety','Communication','Weather','Tools & Equipment','Work & Tasks','Family & People','Documents','Money','Borders','Misc'
  ];

  let PHRASES = [];

  // fetch external JSON
  fetch('phrases.json')
    .then(res => res.json())
    .then(data => {
      PHRASES = data;
      initUI();
    });

  function initUI(){
    const $ = sel => document.querySelector(sel);
    const fromSel = $('#fromLang');
    const toSel = $('#toLang');
    const q = $('#q');
    const chips = $('#chips');
    const tbody = $('#tbody');
    const empty = $('#empty');
    const fromTag = $('#fromTag');
    const toTag = $('#toTag');
    const showAll = $('#showAll');
    const stat = $('#stat');

    LANGS.forEach(l => {
      const o1 = new Option(`${l.name} (${l.code})`, l.code); fromSel.add(o1);
      const o2 = new Option(`${l.name} (${l.code})`, l.code); toSel.add(o2);
    });
    fromSel.value = 'en';
    toSel.value = 'es';

    let activeCats = new Set();
    CATS.forEach(c => {
      const el = document.createElement('div');
      el.className = 'chip'; el.textContent = c; el.dataset.cat = c;
      el.onclick = () => { if(activeCats.has(c)) activeCats.delete(c); else activeCats.add(c); el.classList.toggle('active'); render(); };
      chips.appendChild(el);
    });

    [fromSel, toSel].forEach(s => s.addEventListener('change', render));
    q.addEventListener('input', debounce(render, 80));
    showAll.addEventListener('change', render);
    $('#clearFilters').onclick = () => { q.value=''; activeCats.clear(); chips.querySelectorAll('.chip.active').forEach(e=>e.classList.remove('active')); render(); };
    $('#randomBtn').onclick = () => { const idx = Math.floor(Math.random()*PHRASES.length); const p = PHRASES[idx]; q.value = ''; activeCats = new Set([p.cat]); chips.querySelectorAll('.chip').forEach(el=>{ el.classList.toggle('active', el.dataset.cat===p.cat);}); render(p.id); };

    function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); } }

    function render(scrollToId=null){
      const from = fromSel.value; const to = toSel.value;
      fromTag.textContent = `(${from.toUpperCase()})`;
      toTag.textContent = showAll.checked? '(all)' : `(${to.toUpperCase()})`;

      const qtxt = q.value.trim().toLowerCase();
      let filtered = PHRASES.filter(p => {
        if(activeCats.size && !activeCats.has(p.cat)) return false;
        if(!qtxt) return true;
        const hay = [p.t.en, p.t[from], p.t[to], ...Object.values(p.t)].filter(Boolean).join(' ').toLowerCase();
        return hay.includes(qtxt);
      });

      stat.textContent = `${filtered.length} of ${PHRASES.length} phrases`;

      tbody.innerHTML = '';
      if(!filtered.length){ empty.style.display='block'; return; } else empty.style.display='none';

      filtered.forEach(p => {
        const tr = document.createElement('tr');
        const tdCat = document.createElement('td'); tdCat.textContent = p.cat; tr.appendChild(tdCat);

        const tdFrom = document.createElement('td');
        tdFrom.innerHTML = `<div class="big">${esc(p.t[from]||p.t.en)}</div><div class="langTag">${p.t.en}</div>`;
        tr.appendChild(tdFrom);

        const tdTo = document.createElement('td');
        if(showAll.checked){
          tdTo.innerHTML = LANGS.filter(l=>l.code!==from).map(l=>{
            return `<div style="margin-bottom:6px"><div class="langTag">${l.name} (${l.code})</div><div class="big">${esc(p.t[l.code]||'—')}</div></div>`
          }).join('');
        } else {
          tdTo.innerHTML = `<div class="big">${esc(p.t[to]||'—')}</div>`;
        }
        tr.appendChild(tdTo);

        const tdTools = document.createElement('td');
        const btns = document.createElement('div'); btns.className='rowtools';
        btns.appendChild(iconBtn('🔊', 'Speak (from)', ()=>ttsSpeak(p.t[from]||p.t.en, from)));
        btns.appendChild(iconBtn('🔊', 'Speak (to)', ()=> {
          if(showAll.checked){
            LANGS.filter(l=>l.code!==from).forEach(l=>ttsSpeak(p.t[l.code], l.code));
          } else ttsSpeak(p.t[to], to);
        }));
        btns.appendChild(iconBtn('📋', 'Copy translation', ()=>{
          const str = showAll.checked ? LANGS.filter(l=>l.code!==from).map(l=>`${l.name}: ${p.t[l.code]||''}`).join('\n') : (p.t[to]||'');
          copy(str);
        }));
        tdTools.appendChild(btns); tr.appendChild(tdTools);
        tbody.appendChild(tr);

        if(scrollToId && p.id===scrollToId){ tr.scrollIntoView({behavior:'smooth', block:'center'}); }
      });
    }

    function iconBtn(symbol, title, onClick){ const b=document.createElement('button'); b.className='icon'; b.textContent=symbol+" "+title; b.onclick=onClick; return b; }
    function esc(s){ return (s||'').replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }
    function copy(text){ if(!text) return; navigator.clipboard?.writeText(text); }

    function ttsSpeak(text, langCode){
      if(!text) return;
      const u = new SpeechSynthesisUtterance(text);
      const meta = LANGS.find(l=>l.code===langCode);
      if(meta) u.lang = meta.tts;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    render();
  }
</script>
</body>
</html>
